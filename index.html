<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta tags and imports -->
    <meta charset="utf-8" />
    <title>AI Training</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/styles/index.css" />
  </head>

  <body>
    <div id="page-1">
      <div class="page-container">
        <div class="sctn">
          <h1 class="title">MAKE: AI ROBOTS</h1>
          <p class="paragraph">
            Give your micro:bit project AI superpowers! This site will allow
            your micro:bit to use your computer's webcam to recognize images.
          </p>

          <!-- Button for micro:bit connection -->
          <span class="btn-container">
            <button id="requestPortButton">
              3. Connect your micro:bit to your AI!
            </button>
            <p id="status" class="paragraph btn-sub">
              Select the Microbit in the popup screen. It might be called "mbed Serial Port."
            </p>
          </span>
        </div>
      </div>
    </div>

    <!-- Page 2 (Initially Hidden) -->
    <div id="page-2" style="display: none;">
      <h1>Not sure what to do?</h1>
      <p>Visit the Teachable Machine to train an AI project:</p>
      <button onclick="window.open('https://teachablemachine.withgoogle.com/', '_blank')">Google Teachable Machine</button>
      <p>
        Paste your Google Teachable machine model link here:
        <input type="url" id="teachableUrl" placeholder="https://teachablemachine.withgoogle.com/models/[...]" required />
      </p>
      <button id="readyButton">Ready!</button>
    </div>

    <script>
      const connectButton = document.getElementById("requestPortButton");
      const status = document.getElementById("status");
      const page1 = document.getElementById("page-1");
      const page2 = document.getElementById("page-2");

      // Function to handle micro:bit connection
      connectButton.addEventListener("click", async () => {
        try {
          status.innerText = "Attempting to connect to micro:bit...";
          console.log("Attempting to connect to micro:bit...");

          // Request device with specific vendorId for micro:bit
          const device = await navigator.usb.requestDevice({
            filters: [{ vendorId: 0x0D28 }]
          });

          status.innerText = "Device found. Opening connection...";
          console.log("Device found. Opening connection...");

          await device.open(); // Open the device

          if (device.configuration === null) {
            status.innerText = "Selecting configuration...";
            console.log("Selecting configuration...");
            await device.selectConfiguration(1);
          }

          status.innerText = "Claiming interface for communication...";
          console.log("Claiming interface for communication...");
          await device.claimInterface(0); // Claim interface for communication

          console.log("Micro:bit connected successfully");
          status.innerText = "Micro:bit connected successfully!";
          alert("Micro:bit connected successfully!");

          // Transition to the next page (page 2)
          page1.style.display = "none";
          page2.style.display = "block";

        } catch (err) {
          console.error("Error connecting to micro:bit: ", err);
          status.innerText = `Failed to connect to micro:bit. Error: ${err.message}`;
          alert("Failed to connect to micro:bit. Please check console for more details.");
        }
      });
    </script>
  </body>
</html>
